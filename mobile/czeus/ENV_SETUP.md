# Mobile App Environment Setup

## Quick Setup (Required)

⚠️ **Important**: The mobile app will fall back to demo mode if environment variables are not configured!

### Step 1: Copy Environment File
```bash
# Navigate to the mobile app directory
cd mobile/czeus

# Copy the example environment file
cp .env.example .env
```

The `.env.example` file contains the correct Supabase credentials for this project.

## Required Environment Variables

The `.env` file should contain the following variables:

```env
EXPO_PUBLIC_SUPABASE_URL=https://zrzljtoctzpvrkbckthr.supabase.co
EXPO_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpyemxqdG9jdHpwdnJrYmNrdGhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxMjc3MzksImV4cCI6MjA2OTcwMzczOX0.PWkiEi2Q18-11AXIO_hcKCAZR3JPQkp-fEEvrAzUbKY
EXPO_PUBLIC_SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpyemxqdG9jdHpwdnJrYmNrdGhyIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NDEyNzczOSwiZXhwIjoyMDY5NzAzNzM5fQ.h6sssgDPr_Egq8rjJjrLLw8PHciwv1a6SwJioB-w8ac
EXPO_PUBLIC_SUPABASE_SESSION_STORAGE_KEY=sb-zrzljtoctzpvrkbckthr-auth-token
```

## Database Requirements

The mobile app expects the following table structure in Supabase:

### profiles table
```sql
create table public.profiles (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  updated_at timestamp with time zone null,
  deleted_at timestamp with time zone null,
  first_name text not null,
  middle_name text null,
  last_name text not null,
  birth_day date null,
  profile_picture text null,
  email text not null,
  role public.role_enum not null,
  phone text null,
  position text null,
  address text null,
  constraint Profiles_pkey primary key (id)
) TABLESPACE pg_default;
```

## Authentication Features

The mobile app now supports:

- **Real Supabase Authentication**: No more demo mode
- **User Registration**: Creates profile entries automatically
- **Password Reset**: Real email-based password reset
- **Session Persistence**: Automatic login on app restart
- **Profile Integration**: Fetches user data from profiles table

## Setup Instructions

1. **Copy the environment file**: `cp .env.example .env`
2. Ensure your Supabase database has the `profiles` table created
3. Configure Row Level Security (RLS) policies as needed
4. Test authentication by registering a new user or signing in

## Troubleshooting

### App Falls Back to Demo Mode
If the user management system shows demo data instead of connecting to Supabase:

1. **Environment Setup**: Verify the `.env` file exists in `mobile/czeus/`
   ```bash
   cd mobile/czeus
   ls -la .env  # Should show the .env file
   ```

2. **Copy Environment File**: If missing, copy from the example:
   ```bash
   cp .env.example .env
   ```

3. **Restart the App**: After creating `.env`, restart the Expo development server:
   ```bash
   # Stop the current server (Ctrl+C)
   npx expo start
   ```

### Invalid Email Address Errors
If you see "Email address invalid" errors when creating users:

1. **Check Email Format**: Ensure the email follows standard format (user@domain.com)
2. **Supabase Auth Settings**: Verify your Supabase project auth settings:
   - Go to Authentication > Settings in Supabase dashboard
   - Check if there are domain restrictions or email validation rules
   - Ensure the anon key has proper permissions

3. **Test with Different Email**: Try with a different email domain (gmail.com, etc.)

### Connection Issues
If you see connection-related errors:

1. **Check Supabase Status**: Verify your Supabase project is active
2. **Test API Keys**: Ensure the anon key in `.env` matches your Supabase project
3. **Network Issues**: Check your internet connection and firewall settings

### Environment File Missing
```bash
# If you see "Missing Supabase environment variables" error:
cd mobile/czeus
cp .env.example .env
# Then restart the app
npx expo start
```

### User Creation Fails
If user creation fails but the app doesn't fall back to demo mode:

1. **Email Validation**: The app now includes client-side email validation
2. **Duplicate Email**: Check if the email is already registered
3. **Auth Permissions**: Verify Supabase auth settings allow user registration

## Security Notes

- The `.env` file is automatically ignored by git
- Never commit environment variables to version control
- Use environment-specific credentials for different deployments